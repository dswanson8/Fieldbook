<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Digital Field Book â€“ QA/QC GPS</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f172a;           /* slate-900 */
      --card:#111827;         /* gray-900 */
      --muted:#94a3b8;        /* slate-400 */
      --text:#e5e7eb;         /* gray-200 */
      --accent:#38bdf8;       /* sky-400 */
      --accent-2:#22c55e;     /* green-500 */
      --warn:#f59e0b;         /* amber-500 */
      --bad:#ef4444;          /* red-500 */
      --calc:#111827;         /* dark cell bg */
      --calc-border:#1f2937;  /* dark border */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text); font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      -webkit-tap-highlight-color: transparent;
    }
    .wrap{max-width:1100px;margin:0 auto;padding:clamp(10px,3vw,24px)}

    header{
      position:sticky; top:0; z-index:30;
      background:linear-gradient(180deg, rgba(15,23,42,.98), rgba(15,23,42,.92));
      backdrop-filter: blur(6px);
      border-bottom:1px solid #1e293b;
    }
    .head{display:flex; gap:12px; align-items:center; justify-content:space-between; padding:12px 0}
    .titlebar{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    h1{font-size:clamp(16px,3.5vw,22px); margin:0; font-weight:700; letter-spacing:.2px}
    .meta{display:flex; gap:10px; flex-wrap:wrap}
    .meta input{min-width:140px}

    .card{background:var(--card); border:1px solid #1f2937; border-radius:14px; padding:12px; box-shadow: 0 10px 20px rgba(0,0,0,.2)}
    .toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .toolbar .spacer{flex:1}

    button, .seg label{
      appearance:none; border:1px solid #1f2937; background:#0b1220; color:var(--text);
      padding:10px 12px; border-radius:10px; font-weight:600; font-size:14px;
      letter-spacing:.2px; cursor:pointer; user-select:none;
    }
    button:active{transform:translateY(1px)}
    button.primary{background:var(--accent); border-color:#0891b2; color:#001018}
    button.ghost{background:transparent}
    .seg{display:inline-flex; border:1px solid #1f2937; border-radius:10px; overflow:hidden}
    .seg input{display:none}
    .seg label{padding:8px 12px; border:0; background:#0b1220}
    .seg input:checked + label{background:#083344; color:#7dd3fc}

    .chips{display:flex; gap:8px; flex-wrap:wrap}
    .chip{padding:8px 10px; border:1px solid #1f2937; border-radius:999px; font-size:12px; color:var(--muted)}

    table{width:100%; border-collapse:separate; border-spacing:0; margin-top:10px}
    thead th{
      position:sticky; top:calc(56px + 12px); z-index:20;
      background:#0b1220; color:var(--muted); font-weight:600; text-align:left;
      border-bottom:1px solid #1f2937; padding:10px; font-size:12px;
    }
    tbody td{border-bottom:1px solid #1f2937; padding:8px 10px; font-size:14px; vertical-align:middle}

    .cell-edit{background:#0b1220; border:1px dashed transparent; border-radius:8px; min-height:40px}
    .cell-edit:focus-within{outline:0; border-color:#0ea5e9; box-shadow:0 0 0 2px rgba(56,189,248,.25)}
    .cell-calc{background:var(--calc); color:#cbd5e1; border-radius:8px}
    .cell-input{width:100%; background:transparent; border:0; color:var(--text); font:inherit; padding:8px 6px; outline:none}
    .cell-input::placeholder{color:#64748b}
    .cell-input:-webkit-autofill, .cell-input:-webkit-autofill:focus{transition:background-color 99999s ease-in-out 0s}

    .pill{font-size:12px; padding:4px 8px; border-radius:999px; background:#0b1220; border:1px solid #1f2937}
    .type-bs{color:#7dd3fc; border-color:#0ea5e9}
    .type-fs{color:#a7f3d0; border-color:#10b981}

    .qa-green{background:rgba(34,197,94,.15)!important; color:#86efac!important}
    .qa-yellow{background:rgba(245,158,11,.15)!important; color:#fcd34d!important}
    .qa-red{background:rgba(239,68,68,.15)!important; color:#fca5a5!important}

    .footerbar{position:sticky; bottom:0; z-index:20; margin-top:12px}
    .footerbar .card{display:flex; gap:10px; align-items:center; justify-content:space-between}

    input, select{background:#0b1220; color:var(--text); border:1px solid #1f2937; border-radius:10px; padding:10px 12px}
    input::placeholder{color:#64748b}

    @media (hover:none){
      button, .seg label, input, .cell-edit{padding:12px 14px}
      tbody td{padding:10px 12px}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap head">
      <div class="titlebar">
        <h1>Digital Field Book â€” QA/QC GPS</h1><span class="chip" id="statusChip">Ready</span>
      </div>
      <div class="meta">
        <input id="jobTitle" placeholder="Job Title"> <input id="jobDate" type="date">
      </div>
    </div>
  </header>
  <main class="wrap" id="app">
    <div class="card" style="margin-bottom:12px">
      <div class="toolbar">
        <button id="newSetupBtn" class="primary">+ New Setup</button> <button id="addBsBtn">+ Add BS</button> <button id="addFsBtn">+ Add FS</button>
        <div class="spacer"></div>
        <div class="seg" title="HI aggregator">
          <input type="radio" name="agg" id="aggMedian" checked> <label for="aggMedian">Median HI</label> <input type="radio" name="agg" id="aggMean"> <label for="aggMean">Mean HI</label>
        </div><button id="lockToggle" class="ghost" title="Lock/unlock current setup">ðŸ”’ Lock</button>
      </div>
    </div>
    <div class="chips" id="setupTabs"></div>
    <div class="card">
      <table id="grid">
        <thead>
          <tr>
            <th style="width:70px">Type</th>
            <th>Station</th>
            <th>Known Elev (BS)</th>
            <th>BS (m)</th>
            <th>HI (m)</th>
            <th>FS (m)</th>
            <th>ELEV (m)</th>
            <th>GPS (m)</th>
            <th>Î” GPS (m)</th>
            <th style="width:54px">Del</th>
          </tr>
        </thead>
        <tbody id="gridBody"></tbody>
      </table>
    </div>
    <div class="footerbar">
      <div class="card">
        <div id="summary">
          Setups: 0 â€¢ BS: 0 â€¢ FS: 0 â€¢ G/Y/R: 0/0/0
        </div>
        <div>
          <button id="saveBtn">Save</button> <button id="resetBtn" class="ghost">Reset</button>
        </div>
      </div>
    </div>
  </main>
  <script src="app.js"></script>``` --- # app.js ```javascript /* Digital Field Book â€“ QA/QC GPS (Fresh Start) Mobile-first, Android/iOS friendly - Editable inputs only (station, knownElev[BS], bs[BS], fs[FS], gps[FS]) - Calculated cells locked (hi, elev, delta) - Median/Mean HI toggle - Per-setup lock toggle - LocalStorage persistence */ (function(){ const STORAGE_KEY = 'dfb_v2_state'; const els = { title: byId('jobTitle'), date: byId('jobDate'), status: byId('statusChip'), tabs: byId('setupTabs'), gridBody: byId('gridBody'), btnNewSetup: byId('newSetupBtn'), btnAddBs: byId('addBsBtn'), btnAddFs: byId('addFsBtn'), btnLock: byId('lockToggle'), btnSave: byId('saveBtn'), btnReset: byId('resetBtn'), aggMedian: byId('aggMedian'), aggMean: byId('aggMean'), summary: byId('summary'), }; const state = loadState() || { meta: { title:'', date: todayISO(), thresholds:{ green:0.030, yellow:0.040 } }, settings: { useMedian: true }, setups: [], active: 0, // index }; // Init els.title.value = state.meta.title; els.date.value = state.meta.date; els.aggMedian.checked = !!state.settings.useMedian; els.aggMean.checked = !state.settings.useMedian; els.title.addEventListener('input', commitMeta); els.date.addEventListener('input', commitMeta); els.btnNewSetup.addEventListener('click', () =&gt; { addSetup(); render(); saveState(); }); els.btnAddBs.addEventListener('click', () =&gt; { addRow('BS'); render(); saveState(); }); els.btnAddFs.addEventListener('click', () =&gt; { addRow('FS'); render(); saveState(); }); els.btnLock.addEventListener('click', () =&gt; { toggleLock(); render(); saveState(); }); els.btnSave.addEventListener('click', () =&gt; { saveState(true); flash('Saved'); }); els.btnReset.addEventListener('click', hardReset); els.aggMedian.addEventListener('change', () =&gt; { state.settings.useMedian = true; recomputeActive(); render(); saveState(); }); els.aggMean.addEventListener('change', () =&gt; { state.settings.useMedian = false; recomputeActive(); render(); saveState(); }); // Ensure at least one setup if(state.setups.length === 0) addSetup(); render(); // -------- Core data helpers -------- function addSetup(){ state.setups.push({ locked:false, rows:[] }); state.active = state.setups.length - 1; } function activeSetup(){ return state.setups[state.active]; } function addRow(kind){ const s = activeSetup(); if(s.locked){ flash('Setup is locked'); return; } if(kind === 'BS'){ s.rows.push({ id: uid(), type:'BS', station:'', knownElev:null, bs:null, hi:null }); } else { s.rows.push({ id: uid(), type:'FS', station:'', fs:null, elev:null, gps:null, delta:null }); } recompute(s); } function toggleLock(){ const s = activeSetup(); s.locked = !s.locked; } function commitMeta(){ state.meta.title = els.title.value.trim(); state.meta.date = els.date.value || todayISO(); saveState(); } function recomputeActive(){ recompute(activeSetup()); } function recompute(setup){ // HI per BS setup.rows.forEach(r =&gt; { if(r.type==='BS'){ if(isNum(r.knownElev) &amp;& isNum(r.bs)) r.hi = round3(r.knownElev + r.bs); else r.hi = null; } }); // aggregate HI const his = setup.rows.filter(r=&gt;r.type==='BS' &amp;& isNum(r.hi)).map(r=&gt;r.hi); const hiAgg = his.length ? (state.settings.useMedian ? median(his) : mean(his)) : null; // ELEV & Î” for FS setup.rows.forEach(r =&gt; { if(r.type==='FS'){ if(isNum(hiAgg) &amp;& isNum(r.fs)) r.elev = round3(hiAgg - r.fs); else r.elev = null; if(isNum(r.gps) &amp;& isNum(r.elev)) r.delta = round3(Math.abs(r.gps - r.elev)); else r.delta = null; } }); } // -------- Render -------- function render(){ // Tabs els.tabs.innerHTML = ''; state.setups.forEach((s, i) =&gt; { const b = document.createElement('button'); b.className = 'chip'; b.textContent = `Setup ${i+1}${s.locked?' ðŸ”’':''}`; if(i===state.active){ b.style.borderColor = '#0ea5e9'; b.style.color = '#7dd3fc'; } b.addEventListener('click', ()=&gt;{ state.active = i; render(); saveState(); }); els.tabs.appendChild(b); }); // Lock button icon els.btnLock.textContent = activeSetup().locked ? 'ðŸ”“ Unlock' : 'ðŸ”’ Lock'; // Table body els.gridBody.innerHTML=''; const s = activeSetup(); s.rows.forEach((r, idx) =&gt; { const tr = document.createElement('tr'); // Type pill tr.appendChild(tdPill(r.type)); // Station (editable both types) tr.appendChild(makeCell(r, 'station', r.station, s.locked)); // Known Elev (BS only) tr.appendChild(r.type==='BS' ? makeCell(r,'knownElev', r.knownElev, s.locked) : tdDim()); // BS (m) or dim tr.appendChild(r.type==='BS' ? makeCell(r,'bs', r.bs, s.locked) : tdDim()); // HI (calc) tr.appendChild(makeCalc(r.hi)); // FS (m) or dim tr.appendChild(r.type==='FS' ? makeCell(r,'fs', r.fs, s.locked) : tdDim()); // ELEV (calc) tr.appendChild(makeCalc(r.elev)); // GPS (FS editable) tr.appendChild(r.type==='FS' ? makeCell(r,'gps', r.gps, s.locked) : tdDim()); // Î” GPS (calc + colored) tr.appendChild(makeDelta(r.delta)); // Delete const tdDel = document.createElement('td'); const del = document.createElement('button'); del.textContent = 'âœ•'; del.className='ghost'; del.addEventListener('click', ()=&gt;{ if(s.locked) return flash('Setup is locked'); s.rows.splice(idx,1); recompute(s); render(); saveState(); }); tdDel.appendChild(del); tr.appendChild(tdDel); els.gridBody.appendChild(tr); }); updateSummary(); } function tdPill(type){ const td = document.createElement('td'); const span = document.createElement('span'); span.className = 'pill ' + (type==='BS'?'type-bs':'type-fs'); span.textContent = type; td.appendChild(span); return td; } function tdDim(){ const td=document.createElement('td'); td.textContent='â€”'; td.className='cell-calc'; return td; } function makeCalc(value){ const td = document.createElement('td'); td.className = 'cell-calc'; td.textContent = isNum(value) ? num3(value) : 'â€”'; return td; } function makeDelta(delta){ const td = makeCalc(delta); if(isNum(delta)){ const cls = qaClass(delta, state.meta.thresholds); if(cls) td.classList.add(cls); } return td; } function makeCell(row, field, value, locked){ const td = document.createElement('td'); const editable = isEditableField(row, field) &amp;& !locked; if(!editable){ td.className = 'cell-calc'; td.textContent = isNum(value) ? num3(value) : (value ?? ''); return td; } td.className = 'cell-edit'; if(field === 'station'){ const input = document.createElement('input'); input.type = 'text'; input.className = 'cell-input'; input.inputMode = 'text'; input.autocapitalize = 'characters'; input.spellcheck = false; input.placeholder = ''; input.value = (value ?? '').toString(); input.addEventListener('blur', ()=&gt;{ row.station = input.value.trim(); saveState(); }); td.appendChild(input); return td; } // numeric inputs (BS knownElev, BS, FS, GPS) const input = document.createElement('input'); input.type = 'text'; // keep as text for better control of minus/decimal input.className = 'cell-input'; input.inputMode = 'decimal'; // mobile numeric keypad with decimal input.enterKeyHint = 'next'; input.autocorrect = 'off'; input.autocomplete = 'off'; input.spellcheck = false; input.placeholder = ''; input.value = isNum(value) ? String(value) : (value ?? ''); input.addEventListener('blur', ()=&gt;{ const v = sanitizeNumber(input.value); row[field] = (v === null ? null : v); recompute(activeSetup()); render(); saveState(); }); td.appendChild(input); return td; } function isEditableField(row, field){(row, field){ if(field === 'station') return true; if(row.type==='BS') return (field==='knownElev' || field==='bs'); if(row.type==='FS') return (field==='fs' || field==='gps'); return false; } function qaClass(delta, thr){ if(delta &lt;= thr.green) return 'qa-green'; if(delta &lt;= thr.yellow) return 'qa-yellow'; return 'qa-red'; } function updateSummary(){ let bs=0, fs=0, g=0, y=0, r=0; state.setups.forEach(s=&gt;{ s.rows.forEach(row=&gt;{ if(row.type==='BS') bs++; else fs++; if(isNum(row.delta)){ const cls = qaClass(row.delta, state.meta.thresholds); if(cls==='qa-green') g++; else if(cls==='qa-yellow') y++; else r++; } }) }) els.summary.textContent = `Setups: ${state.setups.length} â€¢ BS: ${bs} â€¢ FS: ${fs} â€¢ G/Y/R: ${g}/${y}/${r}`; } // -------- Storage -------- function saveState(andStatus){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); if(andStatus) setStatus('Saved'); } catch(e){ setStatus('Save failed'); console.error(e); } } function loadState(){ try{ const s = localStorage.getItem(STORAGE_KEY); return s ? JSON.parse(s) : null; } catch(e){ return null; } } function hardReset(){ if(confirm('Reset all data?')){ localStorage.removeItem(STORAGE_KEY); location.reload(); } } // -------- Utils -------- function byId(id){ return document.getElementById(id); } function todayISO(){ return new Date().toISOString().slice(0,10); } function uid(){ return Math.random().toString(36).slice(2,9); } function isNum(v){ return typeof v==='number' &amp;& isFinite(v); } function round3(v){ return Math.round(v*1000)/1000; } function num3(v){ return (Math.round(v*1000)/1000).toFixed(3); } function mean(a){ return a.length ? a.reduce((s,x)=&gt;s+x,0)/a.length : null; } function median(a){ if(!a.length) return null; const b=[...a].sort((x,y)=&gt;x-y); const m=Math.floor(b.length/2); return b.length%2? b[m] : (b[m-1]+b[m])/2; } function sanitizeNumber(str){ if(str == null) return null; let s = String(str).trim(); if(!s) return null; // Normalize comma decimals to dot s = s.replace(',', '.'); // Allow only digits, optional leading sign, single dot const cleaned = s.replace(/[^0-9+\-\.]/g,''); if(cleaned === '' || cleaned === '-' || cleaned === '.' || cleaned === '+') return null; const n = Number(cleaned); return isFinite(n) ? n : null; } function setStatus(msg){(msg){ els.status.textContent = msg; setTimeout(()=&gt;{ els.status.textContent='Ready'; }, 1200); } function flash(msg){ setStatus(msg); } })(); ```
</body>
</html>