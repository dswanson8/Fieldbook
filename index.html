<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Field Book</title>
  <link rel="stylesheet" type="text/css" href="style.min.css">
  <style>
    body,
    input,
    button {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif !important;
      font-feature-settings: "tnum" !important;
      /* enable tabular numbers */
    }
  </style>
</head>

<body>
  <header>
    <div class="wrap head">
      <div class="meta">
        <input id="jobTitle" placeholder="Job Title"> <input id="jobDate" type="date">
      </div>
    </div>
  </header>
  <main class="wrap" id="app">
    <div class="card">
      <div class="toolbar">
        <button id="newSetupBtn" class="primary">+ New Setup</button>
        <div class="addBtn">
          <button id="addBsBtn">+ Add BS</button>
          <button id="addFsBtn">+ Add FS</button>
        </div>
        <div class="seg wide" title="HI aggregator">
          <input type="radio" name="agg" id="aggMedian" checked> <label for="aggMedian">Median HI</label> <input
            type="radio" name="agg" id="aggMean"> <label for="aggMean">Mean HI</label>
        </div><button id="lockToggle" class="ghost wide" title="Lock/unlock current setup">ðŸ”’ Lock</button>
      </div>
    </div>
    <div class="chips" id="setupTabs"></div>
    <!-- Shows only when active setup > 0 -->
    <div id="existingBsBar" class="hidden" style="margin-bottom:10px;">
      <button id="addExistingBsBtn" class="chip">+ Add Existing BS</button>
    </div>
    <div class="card">
      <table id="grid">
        <colgroup>
          <col class="small">
          <col class="small">
          <col class="small">
          <col class="small">
          <col class="small">
          <col class="small">
        </colgroup>
        <thead>
          <tr>
            <th>STA</th>
            <th>BS</th>
            <th>HI</th>
            <th>FS</th>
            <th>ELEV</th>
            <th>GPS</th>
          </tr>
        </thead>
        <tbody id="gridBody"></tbody>
      </table>
    </div>
    <div class="footerbar">
      <div class="card">
        <div id="summary">
          Setups: 0 â€¢ BS: 0 â€¢ FS: 0 â€¢ G/Y/R: 0/0/0
        </div>
        <div class="addBtn">
          <button id="exportAllBtn">Export All (PDF/Print)</button>
          <button id="resetBtn" class="ghost">Reset</button>
          <button id="toolsBtn" class="ghost wide">Slope</button>
          <button id="gradeSpotsBtn" class="ghost">Grade Sheet</button>
        </div>
      </div>
    </div>
  </main>

  <!-- Tools Flyout (bottom sheet) -->
  <div id="toolsSheet" class="sheet hidden" aria-hidden="true">
    <div class="sheet-backdrop" id="toolsBackdrop"></div>
    <div class="sheet-panel" role="dialog" aria-labelledby="toolsTitle">
      <div class="sheet-header">
        <button id="toolsClose" class="ghost">âœ•</button>
      </div>

      <div class="tool-card">
        <div class="tool-title">Slope Checker</div>
        <div class="tool-grid">
          <input id="scStartSta" placeholder="Start Station (opt.)" inputmode="text">
          <input id="scEndSta" placeholder="End Station (opt.)" inputmode="text">
          <input id="scDStart" placeholder="Design Elev @ Start" inputmode="decimal">
          <input id="scDEnd" placeholder="Design Elev @ End" inputmode="decimal">
          <input id="scAStart" placeholder="ASB Elev @ Start" inputmode="decimal">
          <input id="scAEnd" placeholder="ASB Elev @ End" inputmode="decimal">
          <input id="scLen" placeholder="Segment Length (m)" inputmode="decimal">
        </div>
        <div id="scResults" class="tool-results"></div>
        <div class="tool-actions">
          <button id="scCompute" class="primary">Compute</button>
          <button id="scClear" class="ghost">Clear</button>
        </div>
      </div>

      <!-- Slope Calculator (solve 1 unknown) -->
      <div class="tool-card" style="margin-top:12px">
        <div class="tool-title">Slope Calculator (solve 1 unknown)</div>
        <div class="tool-grid">
          <input id="slcStart" placeholder="Bottom Elev (m)" inputmode="decimal">
          <input id="slcEnd" placeholder="Top Elev (m)" inputmode="decimal">
          <input id="slcSlope" placeholder="Slope (%)" inputmode="decimal">
          <input id="slcLen" placeholder="Length (m)" inputmode="decimal">
        </div>
        <div id="slcResults" class="tool-results"></div>
        <div class="tool-actions">
          <button id="slcCompute" class="primary">Compute</button>
          <button id="slcClear" class="ghost">Clear</button>
        </div>
      </div>

    </div>
  </div>

  <!-- Existing BS Picker (bottom sheet) -->
  <div id="bsPickerSheet" class="sheet hidden" aria-hidden="true">
    <div class="sheet-backdrop" id="bsPickerBackdrop"></div>
    <div class="sheet-panel" role="dialog" aria-labelledby="bsPickerTitle">
      <div class="sheet-header">
        <div id="bsPickerTitle">Add Existing BS</div>
        <button id="bsPickerClose" class="ghost">âœ•</button>
      </div>
      <div id="bsPickerList"></div>
    </div>
  </div>

  <!-- Grade Spot Check Sheet -->
  <div id="gradeSpotsSheet" class="sheet hidden" aria-hidden="true">
    <div class="sheet-backdrop" id="gradeSpotsBackdrop"></div>
    <div class="sheet-panel" role="dialog" aria-labelledby="gradeSpotsTitle">
      <div class="sheet-header">
        <button id="gradeSpotsClose" class="ghost">âœ•</button>
      </div>

      <!-- Universal subtract input -->
      <div style="margin-bottom:12px;display:flex;gap:8px;align-items:center">
        <input id="invDrop" placeholder="Topâ†’Invert subtract (m)" inputmode="decimal" style="flex:1 1 100%">
        <button id="addGradeRowBtn" class="primary">+ Row</button>
        <button id="clearGradeRowsBtn" class="ghost">Clear</button>
      </div>

      <!-- Table -->
      <table style="width:100%;border-collapse:separate;border-spacing:0;table-layout:fixed">
        <thead>
          <tr>
            <th style="width:28%">STA</th>
            <th style="width:24%">Design Inv</th>
            <th style="width:24%">ASB Top</th>
            <th style="width:24%">Î” (ASB Inv âˆ’ Design)</th>
          </tr>
        </thead>
        <tbody id="gradeSpotsBody"></tbody>
      </table>
    </div>
  </div>

  <!-- ASB Elevation Picker (grid) -->
  <div id="asbPickerSheet" class="sheet hidden" aria-hidden="true">
    <div class="sheet-backdrop" id="asbPickerBackdrop"></div>
    <div class="sheet-panel" role="dialog" aria-labelledby="asbPickerTitle">
      <div class="sheet-header">
        <button id="asbPickerClose" class="ghost">âœ•</button>
      </div>
      <div id="asbPickerList" class="bs-grid"></div>
    </div>
  </div>

  <script src="app.min.js?v=2025-11-06-V5"></script>
</body>

</html>